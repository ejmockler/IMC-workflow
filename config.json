{
  "project_name": "imc_analysis",
  "project_id": "kidney_healing_2024",
  "project_version": "1.0",
  "data": {
    "raw_data_dir": "data/241218_IMC_Alun",
    "metadata_file": "data/241218_IMC_Alun/Metadata-Table 1.csv",
    "file_pattern": "*.txt"
  },
  "channels": {
    "protein_channels": [
      "CD45", "CD11b", "Ly6G", "CD140a", "CD140b", 
      "CD31", "CD34", "CD206", "CD44"
    ],
    "dna_channels": ["DNA1", "DNA2"],
    "background_channel": "190BCKG",
    "calibration_channels": ["130Ba", "131Xe"],
    "carrier_gas_channel": "80ArAr",
    "excluded_channels": [
      "Start_push", "End_push", "Pushes_duration", "Z"
    ],
    "coordinate_channels": ["X", "Y"]
  },
  "channel_groups": {
    "immune_markers": {
      "pan_leukocyte": ["CD45"],
      "myeloid": ["CD11b", "Ly6G", "CD206"]
    },
    "stromal_markers": {
      "fibroblasts": ["CD140a", "CD140b"]
    },
    "vascular_markers": {
      "endothelial": ["CD31", "CD34"]
    },
    "adhesion_markers": ["CD44"]
  },
  "processing": {
    "background_correction": {
      "enabled": true,
      "method": "pixel_subtraction",
      "clip_negative": true
    },
    "arcsinh_transform": {
      "cofactor": 1.0,
      "auto_optimize": false
    },
    "normalization": {
      "method": "standardize",
      "per_channel": true
    }
  },
  "segmentation": {
    "method": "slic",
    "slic_input_channels": ["DNA1", "DNA2"],
    "slic_params": {
      "n_segments_per_mm2": 2500,
      "compactness": 10.0,
      "sigma": 2.0
    },
    "scales_um": [10.0, 20.0, 40.0]
  },
  "analysis": {
    "analyze_regions_separately": true,
    "anatomical_regions": ["Cortex", "Medulla"],
    "clustering": {
      "n_clusters": 8,
      "optimization_method": "comprehensive",
      "k_range": [2, 12],
      "random_state": 42
    },
    "batch_correction": {
      "enabled": true,
      "method": "sham_anchored",
      "sham_condition": "Sham",
      "sham_timepoint": 0,
      "group_by": ["timepoint", "replicate_id"]
    }
  },
  "quality_control": {
    "monitor_calibration": true,
    "calibration_cv_threshold": 0.2,
    "monitor_carrier_gas": true,
    "min_carrier_gas_signal": 100,
    "generate_qc_plots": true,
    "thresholds": {
      "total_ion_counts": {
        "min_tic_percentile": 10,
        "max_low_tic_pixels_percent": 20,
        "description": "TIC monitoring - flags ROIs with acquisition issues"
      },
      "calibration_drift": {
        "max_drift_percent": 5,
        "max_cv_across_rois": 0.3,
        "description": "Calibration stability across entire acquisition run"
      },
      "segmentation_quality": {
        "min_dna_signal": 1.0,
        "min_tissue_coverage_percent": 10,
        "dna_threshold_std_multiplier": 2.0,
        "description": "DNA signal quality for SLIC segmentation feasibility"
      },
      "signal_to_background": {
        "min_snr": 3.0,
        "description": "Minimum signal-to-background ratio for protein channels"
      },
      "spatial_artifacts": {
        "edge_distance_fraction": 0.1,
        "significance_threshold": 0.01,
        "fold_change_threshold": 2.0,
        "description": "Detection of edge effects and spatial artifacts"
      }
    }
  },
  "output": {
    "results_dir": "results/analysis",
    "roi_results_dir": "roi_results",
    "qc_dir": "quality_control",
    "save_intermediate": false,
    "save_format": "hdf5",
    "compression": true
  },
  "performance": {
    "parallel_processes": null,
    "memory_limit_gb": 4.0,
    "chunk_size": "auto"
  },
  "metadata_tracking": {
    "preserve_fields": [
      "Condition", "Injury Day", "Mouse", 
      "ROI", "Details", "File Name"
    ],
    "batch_definition": ["Timepoint", "Replicate"],
    "stratification_fields": ["Details"],
    "replicate_column": "Mouse",
    "timepoint_column": "Injury Day",
    "condition_column": "Condition",
    "region_column": "Details"
  }
}